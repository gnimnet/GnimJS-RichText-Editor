/*
 *  This JavaScript file for Rich Text Editor
 *  this component works for GnimJS
 *  Version 0.1.1
 *  Write by Ming
 *  Date 2021.01.19
 */
(function(L,C,E){var w=0;var l=null;var H=C.broswer.msie;var p=H&&C.broswer.version==6;var V="richeditor_";var M="richeditor";var s=M+"-color";var I=s+"-line";var K=s+"-item";var t=M+"-toolbox";var T=t+"-select";var f=t+"-divider";var c=t+"-item";var d=c+"-hover";var k=M+"-textarea";var r=M+"-iframe";var n=M+"-mask";var P={display:"block"};var z={display:"none"};var b=0;var q=1;var S=2;var F=3;var e=4;var u="\u7ea7\u6807\u9898";var G=[["\u4e00"+u,"<h1>"],["\u4e8c"+u,"<h2>"],["\u4e09"+u,"<h3>"],["\u56db"+u,"<h4>"],["\u4e94"+u,"<h5>"],["\u516d"+u,"<h6>"],["\u683c\u5f0f\u5316","<pre>"],["\u6bb5\u843d","<p>"]];var v=["Verdana","Arial","Georgia"];var J=[1,2,3,4,5,6,7];var o="styleWithCSS";var g=[[1,"undo","\u64a4\u6d88"],[1,"redo","\u91cd\u505a"],0,[3,"print","\u6253\u5370"],0,[1,"justifyleft","\u5de6\u5bf9\u9f50"],[1,"justifycenter","\u5c45\u4e2d"],[1,"justifyright","\u53f3\u5bf9\u9f50"],[1,"justifyfull","\u4e24\u7aef\u5bf9\u9f50"],0,[1,"createlink","\u94fe\u63a5","\u8f93\u5165\u94fe\u63a5\u5730\u5740\uff1a"],[1,"unlink","\u53d6\u6d88\u94fe\u63a5"],[1,"insertimage","\u56fe\u7247","\u8f93\u5165\u56fe\u7247\u5730\u5740\uff1a"],[1,"inserthorizontalrule","\u5206\u5272\u7ebf"],0,[1,"insertunorderedlist","\u65e0\u5e8f\u5217\u8868"],[1,"insertorderedlist","\u6709\u5e8f\u5217\u8868"],0,[1,"indent","\u5de6\u7f29\u8fdb"],[1,"outdent","\u53f3\u7f29\u8fdb"],0,[1,"removeformat","\u5220\u9664\u6837\u5f0f"],false,[1,"formatblock","\u6807\u9898","\u6807\u9898:",G],[1,"fontname","\u5b57\u4f53","\u5b57\u4f53:",v],[1,"fontsize","\u5b57\u53f7","\u5b57\u53f7:",J],0,[1,"forecolor","\u5b57\u4f53\u989c\u8272","\u5b57\u4f53\u989c\u8272:","c"],[1,H?"backcolor":"hilitecolor","\u5b57\u4f53\u80cc\u666f","\u80cc\u666f\u989c\u8272:","c"],0,[1,"bold","\u52a0\u7c97"],[1,"italic","\u659c\u4f53"],[1,"underline","\u4e0b\u5212\u7ebf"],[1,"strikethrough","\u5220\u9664\u7ebf"],0,[1,"subscript","\u4e0b\u6807"],[1,"superscript","\u4e0a\u6807"],[2,"selectall"],[2,o],[4,"focus"]];function m(Z,ah){var ag=this;var ab=C(Z);if(ab.length!=1){ab.each(function(aj){new m(aj,ah)});return}var Y=ag.autoid=++w;m[Y]=ag;ag.xhtml=ah.xhtml!==false;ag.hook=ah.hook||{};ag._mode=true;var ai=ag.$d=D("div",M).attr("autoid",Y).insertAfter(ab);var X=ag.$b=D("div",t).appendTo(ai);var ae=0;C(g).each(function(aj){if(aj){(function(am,al){if(am[b]==1||am[b]==3){var ak;if(C.isArray(am[e])){B(ag,am[q],ah[am[q]]||am[e],am[S]).appendTo(X)}else{if(am[e]==="c"){ak=D("button",c).click(function(an){R(an);var ao=an.srcElement||an.currentTarget;Q(ao,function(ap){ag[am[q]](ap)})}).appendTo(X)}else{ak=D("button",c).click(function(ap){R(ap);var ao=(ag.hook||{})[am[q]];var an=ag[am[q]];ao?ao():an()}).appendTo(X)}}if(ak){ak.attr("title",am[S]).css(a(al)).hover(function(){ak.css(a(al,1)).addClass(d)},function(){ak.css(a(al)).removeClass(d)});ae++}}})(aj,ae)}else{if(aj===0){X.append(D("span",f))}else{X.append("<br />")}}});ag.$t=ab.css(z).addClass(k).appendTo(ai);var W=V+Y;var af=ag.$i=D("iframe",r).attr("id",W).appendTo(ai);ag.$m=D("div",n).css(z).css({opacity:0.1}).appendTo(ai);var ad=ag.d=(ag.i=af[0].contentWindow||L.frames[W]).document;ad.open();ad.write(ah.html||U(ah.charset,ah.cssFile,ah.content||ab[0].value));ad.close();ad.designMode="on";if(ah[o]!==E){ag[o](ah[o])}var aa=function(){ag._update()};C(ad).keyup(aa).mouseup(aa);var ac=function(){ag._update(1)};ab.keyup(ac).mouseup(ac)}function j(W){var X=this;if(W===E){return X._mode}else{X._mode=!!W;X.$t.css(W?z:P);X.$i.css(W?P:z);X.$b.css(W?P:z)}}function y(X){var W=C(this.d).find("body").html(X);if(X===E&&this.xhtml){W=W.replace(/<span class="apple-style-span">(.*)<\/span>/gi,"$1").replace(/ class="apple-style-span"/gi,"").replace(/<span style="">/gi,"").replace(/<br>/gi,"<br />").replace(/<br ?\/?>$/gi,"").replace(/^<br ?\/?>/gi,"").replace(/(<img [^>]+[^\/])>/gi,"$1 />").replace(/<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>").replace(/<i\b[^>]*>(.*?)<\/i[^>]*>/gi,"<em>$1</em>").replace(/<u\b[^>]*>(.*?)<\/u[^>]*>/gi,'<span style="text-decoration:underline">$1</span>').replace(/<(b|strong|em|i|u) style="font-weight: normal;?">(.*)<\/(b|strong|em|i|u)>/gi,"$2").replace(/<(b|strong|em|i|u) style="(.*)">(.*)<\/(b|strong|em|i|u)>/gi,'<span style="$2"><$4>$3</$4></span>').replace(/<span style="font-weight: normal;?">(.*)<\/span>/gi,"$1").replace(/<span style="font-weight: bold;?">(.*)<\/span>/gi,"<strong>$1</strong>").replace(/<span style="font-style: italic;?">(.*)<\/span>/gi,"<em>$1</em>").replace(/<span style="font-weight: bold;?">(.*)<\/span>|<b\b[^>]*>(.*?)<\/b[^>]*>/gi,"<strong>$1</strong>")}return W}function i(W){this.$m.css(!p&&W?z:P);if(!H){this.d.designMode=W?"on":"off"}}function R(W){C.noBubble(W);C.noDefault(W)}function O(W,X){this.focus().d.execCommand(W,false,X);return this._update()}function N(X){var W=this.$t[0];if(X){this.html(W.value)}else{W.value=this.html()}return this}var h={mode:j,html:y,enable:i,_cmd:O,_update:N};C(g).each(function(X){if(X){if(X[b]==1||X[b]==2){var W;if(X[F]===E){W=new Function("this._cmd('"+X[q]+"');")}else{W=new Function("v",'if(typeof v=="undefined"){v=prompt("'+(X[F]||TEXT_NEED_VAL)+'","");}if(v){this._cmd(\''+X[q]+"',v);}")}h[X[q]]=W}if(X[b]==3||X[b]==4){h[X[q]]=new Function("this.i."+X[q]+"();return this;")}}});m.prototype=h;function D(W,X){return C("<"+W+"></"+W+">").addClass(X)}function B(aa,ab,W,ac){var X=D("select",T);X[0].options.add(new Option(ac));for(var Y=0;Y<W.length;Y++){var Z=W[Y];X[0].options.add(C.isArray(Z)?new Option(Z[0],Z[1]):new Option(Z,Z))}return X.change(function(ad){var ae=ad.srcElement||ad.currentTarget;if(ae.selectedIndex!=0){aa[ab](ae.value);ae.selectedIndex=0}})}function Q(ad,X){if(!l){l=D("div",s).appendTo("body");for(var ac=0;ac<=3;ac++){var af=D("div",I).appendTo(l);var W=ac*85;for(var ab=0;ab<=3;ab++){var Z=ab*85;for(var aa=0;aa<=3;aa++){var ae=aa*85;var Y="#"+C.toHex(((W*256)+Z)*256+ae,6);(function(ag){D("button",K).css({backgroundColor:ag}).click(function(ah){R(ah);if(l.cb){l.cb(ag)}}).appendTo(af)})(Y)}}}}l.cb=X;l.css(A(ad)).css(P)}function A(X){var W=0,Y=X.offsetHeight;while(X.offsetParent){W+=X.offsetLeft;Y+=X.offsetTop;X=X.offsetParent}return{left:W+"px",top:Y+"px"}}function x(){if(l){l.css(z)}}function U(Z,W,Y){var X="";X+="<!DOCTYPE html>";X+="<html><head>";X+='<meta http-equiv="Content-Type" content="text/html; charset='+(Z||"UTF-8")+'" />';X+="<title>RichEditor</title>";X+="<style>::selection{background:#000;color:#fff;}::-moz-selection{background:#000;color:#fff;}</style>";if(W){X+='<link rel="stylesheet" type="text/css" href="'+W+'">'}X+="</head><body>"+(Y||"")+"</body></html>";return X}function a(W,X){return{backgroundPosition:(X?"-30px ":"0 ")+(-W*30)+"px"}}C("body").click(function(){x()});L.RichEditor=m})(window,Gnim);
